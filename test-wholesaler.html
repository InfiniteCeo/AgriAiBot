<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wholesaler Test - AgriAI Bot</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="bg-gray-100 min-h-screen">
    <div class="max-w-4xl mx-auto p-6">
        <h1 class="text-3xl font-bold text-gray-800 mb-8">üß™ Wholesaler Functionality Test</h1>
        
        <!-- Test Authentication -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <h2 class="text-xl font-bold text-gray-800 mb-4">
                <i class="fas fa-key mr-2 text-blue-600"></i>Authentication Test
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <button onclick="testAuth()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors">
                    <i class="fas fa-user-check mr-2"></i>Check Authentication
                </button>
                <button onclick="testWholesalerAccess()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition-colors">
                    <i class="fas fa-warehouse mr-2"></i>Test Wholesaler Access
                </button>
            </div>
        </div>

        <!-- Test Navigation -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <h2 class="text-xl font-bold text-gray-800 mb-4">
                <i class="fas fa-compass mr-2 text-green-600"></i>Navigation Test
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <button onclick="goToWholesaler()" class="bg-teal-600 hover:bg-teal-700 text-white px-4 py-2 rounded-lg transition-colors">
                    <i class="fas fa-warehouse mr-2"></i>Go to Wholesaler Page
                </button>
                <button onclick="goToWholesalerDirect()" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg transition-colors">
                    <i class="fas fa-external-link-alt mr-2"></i>Direct Link
                </button>
                <button onclick="testButtons()" class="bg-orange-600 hover:bg-orange-700 text-white px-4 py-2 rounded-lg transition-colors">
                    <i class="fas fa-mouse-pointer mr-2"></i>Test Buttons
                </button>
            </div>
        </div>

        <!-- Test AI Features -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <h2 class="text-xl font-bold text-gray-800 mb-4">
                <i class="fas fa-robot mr-2 text-purple-600"></i>AI Features Test
            </h2>
            <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                <button onclick="testAIEndpoint('/api/marketplace/ai/dashboard-insights')" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors text-sm">
                    <i class="fas fa-chart-line mr-2"></i>Dashboard
                </button>
                <button onclick="testAIEndpoint('/api/marketplace/ai/product-optimizations')" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg transition-colors text-sm">
                    <i class="fas fa-magic mr-2"></i>Optimize
                </button>
                <button onclick="testAIEndpoint('/api/marketplace/ai/inventory-recommendations')" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition-colors text-sm">
                    <i class="fas fa-warehouse mr-2"></i>Inventory
                </button>
                <button onclick="testAIEndpoint('/api/marketplace/ai/competitive-analysis')" class="bg-orange-600 hover:bg-orange-700 text-white px-4 py-2 rounded-lg transition-colors text-sm">
                    <i class="fas fa-trophy mr-2"></i>Compete
                </button>
                <button onclick="testAIEndpoint('/api/marketplace/ai/sales-insights')" class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg transition-colors text-sm">
                    <i class="fas fa-chart-bar mr-2"></i>Sales
                </button>
                <button onclick="testProductAPI()" class="bg-emerald-600 hover:bg-emerald-700 text-white px-4 py-2 rounded-lg transition-colors text-sm">
                    <i class="fas fa-boxes mr-2"></i>Products
                </button>
            </div>
        </div>

        <!-- Test Results -->
        <div class="bg-white rounded-lg shadow-lg p-6">
            <h2 class="text-xl font-bold text-gray-800 mb-4">
                <i class="fas fa-clipboard-check mr-2 text-green-600"></i>Test Results
            </h2>
            <div id="testResults" class="space-y-2">
                <p class="text-gray-600">Click buttons above to test functionality...</p>
            </div>
        </div>
    </div>

    <script>
        // Test authentication
        async function testAuth() {
            addTestResult('üîê Testing authentication...', 'info');
            
            const token = localStorage.getItem('authToken') || localStorage.getItem('token');
            if (!token) {
                addTestResult('‚ùå No authentication token found', 'error');
                addTestResult('üí° Please login first at: <a href="login.html" class="text-blue-600 underline">login.html</a>', 'warning');
                return;
            }
            
            try {
                const response = await fetch('/api/auth/profile', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    addTestResult(`‚úÖ Authenticated as: ${data.user.name} (${data.user.user_type})`, 'success');
                    
                    if (data.user.user_type === 'wholesaler') {
                        addTestResult('‚úÖ User has wholesaler access', 'success');
                    } else {
                        addTestResult('‚ö†Ô∏è User is not a wholesaler - some features may not work', 'warning');
                    }
                } else {
                    addTestResult('‚ùå Authentication failed - token may be expired', 'error');
                }
            } catch (error) {
                addTestResult(`‚ùå Auth test failed: ${error.message}`, 'error');
            }
        }

        // Test wholesaler access
        async function testWholesalerAccess() {
            addTestResult('üè™ Testing wholesaler access...', 'info');
            
            try {
                const token = localStorage.getItem('authToken') || localStorage.getItem('token');
                const response = await fetch('/api/marketplace/my-products?limit=1', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    addTestResult('‚úÖ Wholesaler API access working', 'success');
                    addTestResult(`üì¶ Found ${data.data?.length || 0} products`, 'info');
                } else {
                    addTestResult(`‚ùå Wholesaler API failed: ${response.status}`, 'error');
                }
            } catch (error) {
                addTestResult(`‚ùå Wholesaler access test failed: ${error.message}`, 'error');
            }
        }

        // Navigation tests
        function goToWholesaler() {
            addTestResult('üß≠ Navigating to wholesaler page via app navigation...', 'info');
            if (typeof window.navigateTo === 'function') {
                window.navigateTo('wholesaler');
            } else if (typeof window.agriApp !== 'undefined') {
                window.agriApp.navigateTo('wholesaler');
            } else {
                addTestResult('‚ö†Ô∏è App navigation not found, using direct link', 'warning');
                goToWholesalerDirect();
            }
        }

        function goToWholesalerDirect() {
            addTestResult('üîó Opening wholesaler page directly...', 'info');
            window.open('wholesaler.html', '_blank');
        }

        function testButtons() {
            addTestResult('üñ±Ô∏è Testing button availability...', 'info');
            
            // Test if we can access wholesaler page elements
            const testWindow = window.open('wholesaler.html', 'test');
            
            setTimeout(() => {
                try {
                    const addProductBtn = testWindow.document.getElementById('addProductBtn');
                    const aiInsightsTab = testWindow.document.getElementById('aiInsightsTab');
                    const refreshAIBtn = testWindow.document.getElementById('refreshAIInsights');
                    
                    if (addProductBtn) {
                        addTestResult('‚úÖ Add Product button found', 'success');
                    } else {
                        addTestResult('‚ùå Add Product button missing', 'error');
                    }
                    
                    if (aiInsightsTab) {
                        addTestResult('‚úÖ AI Insights tab found', 'success');
                    } else {
                        addTestResult('‚ùå AI Insights tab missing', 'error');
                    }
                    
                    if (refreshAIBtn) {
                        addTestResult('‚úÖ Refresh AI button found', 'success');
                    } else {
                        addTestResult('‚ùå Refresh AI button missing', 'error');
                    }
                    
                    testWindow.close();
                } catch (error) {
                    addTestResult(`‚ö†Ô∏è Could not test buttons: ${error.message}`, 'warning');
                    testWindow.close();
                }
            }, 2000);
        }

        // Test AI endpoints
        async function testAIEndpoint(endpoint) {
            addTestResult(`ü§ñ Testing AI endpoint: ${endpoint}`, 'info');
            
            try {
                const token = localStorage.getItem('authToken') || localStorage.getItem('token');
                const response = await fetch(endpoint, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    addTestResult(`‚úÖ ${endpoint} working`, 'success');
                } else {
                    addTestResult(`‚ö†Ô∏è ${endpoint} returned ${response.status}`, 'warning');
                }
            } catch (error) {
                addTestResult(`‚ùå ${endpoint} failed: ${error.message}`, 'error');
            }
        }

        // Test product API
        async function testProductAPI() {
            addTestResult('üì¶ Testing product management API...', 'info');
            
            try {
                const token = localStorage.getItem('authToken') || localStorage.getItem('token');
                
                // Test creating a product
                const testProduct = {
                    name: 'Test Product ' + Date.now(),
                    category: 'Seeds',
                    unit_type: 'kg',
                    unit_price: 100,
                    stock_quantity: 50,
                    description: 'Test product for API validation'
                };
                
                const response = await fetch('/api/marketplace/products', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify(testProduct)
                });
                
                if (response.ok) {
                    const data = await response.json();
                    addTestResult('‚úÖ Product creation API working', 'success');
                    
                    if (data.ai_optimized) {
                        addTestResult('ü§ñ AI optimization applied to product', 'success');
                    }
                } else {
                    addTestResult(`‚ö†Ô∏è Product API returned ${response.status}`, 'warning');
                }
            } catch (error) {
                addTestResult(`‚ùå Product API test failed: ${error.message}`, 'error');
            }
        }

        // Add test result to display
        function addTestResult(message, type) {
            const resultsContainer = document.getElementById('testResults');
            const resultDiv = document.createElement('div');
            
            const colors = {
                'success': 'text-green-700 bg-green-50 border-green-200',
                'error': 'text-red-700 bg-red-50 border-red-200',
                'warning': 'text-yellow-700 bg-yellow-50 border-yellow-200',
                'info': 'text-blue-700 bg-blue-50 border-blue-200'
            };
            
            resultDiv.className = `p-3 rounded-lg border ${colors[type] || colors.info}`;
            resultDiv.innerHTML = `
                <div class="flex items-center">
                    <span class="text-sm font-mono">${new Date().toLocaleTimeString()}</span>
                    <span class="ml-3">${message}</span>
                </div>
            `;
            
            resultsContainer.appendChild(resultDiv);
            resultDiv.scrollIntoView({ behavior: 'smooth' });
        }

        // Initialize test page
        document.addEventListener('DOMContentLoaded', function() {
            addTestResult('üöÄ Wholesaler test page loaded', 'success');
            
            // Auto-run basic tests
            setTimeout(() => {
                testAuth();
            }, 1000);
        });
    </script>
</body>
</html>