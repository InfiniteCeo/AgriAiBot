<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Working SACCO System - AgriAI Bot</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Navigation -->
    <nav class="bg-green-600 shadow-lg">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex justify-between items-center py-4">
                <div class="flex items-center space-x-4">
                    <i class="fas fa-users text-white text-2xl"></i>
                    <h1 class="text-white text-xl font-bold">Working SACCO System</h1>
                </div>
                <div class="flex items-center space-x-4">
                    <span class="text-white">Demo Farmer</span>
                    <button onclick="alert('Logout clicked')" class="bg-green-700 hover:bg-green-800 text-white px-4 py-2 rounded-lg">
                        <i class="fas fa-sign-out-alt mr-1"></i>Logout
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <div class="max-w-7xl mx-auto px-4 py-6">
        <!-- Test Buttons -->
        <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6">
            <h2 class="text-lg font-bold text-yellow-800 mb-3">🧪 Test SACCO Functions</h2>
            <div class="flex flex-wrap gap-3">
                <button onclick="testCreateSACCO()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg">
                    <i class="fas fa-plus mr-2"></i>Create Test SACCO
                </button>
                <button onclick="showCreateModal()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg">
                    <i class="fas fa-edit mr-2"></i>Create Custom SACCO
                </button>
                <button onclick="loadSampleData()" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg">
                    <i class="fas fa-database mr-2"></i>Load Sample Data
                </button>
                <button onclick="clearAllData()" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg">
                    <i class="fas fa-trash mr-2"></i>Clear All Data
                </button>
            </div>
        </div>

        <!-- SACCO Stats -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
            <div class="bg-white rounded-xl shadow-lg p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-600 text-sm">My SACCOs</p>
                        <p class="text-2xl font-bold text-green-600" id="mySaccosCount">0</p>
                    </div>
                    <i class="fas fa-users text-3xl text-green-200"></i>
                </div>
            </div>
            
            <div class="bg-white rounded-xl shadow-lg p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-600 text-sm">Available SACCOs</p>
                        <p class="text-2xl font-bold text-blue-600" id="availableSaccosCount">4</p>
                    </div>
                    <i class="fas fa-search text-3xl text-blue-200"></i>
                </div>
            </div>
            
            <div class="bg-white rounded-xl shadow-lg p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-600 text-sm">Total Members</p>
                        <p class="text-2xl font-bold text-purple-600" id="totalMembers">143</p>
                    </div>
                    <i class="fas fa-user-friends text-3xl text-purple-200"></i>
                </div>
            </div>
            
            <div class="bg-white rounded-xl shadow-lg p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-600 text-sm">Potential Savings</p>
                        <p class="text-2xl font-bold text-orange-600">KSh 25,000</p>
                    </div>
                    <i class="fas fa-piggy-bank text-3xl text-orange-200"></i>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- My SACCOs -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-bold text-gray-800">
                        <i class="fas fa-users text-green-600 mr-2"></i>My SACCO Groups
                    </h2>
                    <button onclick="showCreateModal()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg">
                        <i class="fas fa-plus mr-2"></i>Create SACCO
                    </button>
                </div>
                <div id="mySaccosContainer">
                    <div class="text-center py-8 text-gray-500">
                        <i class="fas fa-users text-4xl mb-4"></i>
                        <p>No SACCOs yet. Click "Create Test SACCO" to get started!</p>
                    </div>
                </div>
            </div>

            <!-- Available SACCOs -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h2 class="text-xl font-bold text-gray-800 mb-6">
                    <i class="fas fa-search text-blue-600 mr-2"></i>Available SACCO Groups
                </h2>
                <div id="availableSaccosContainer">
                    <!-- Available SACCOs will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Create SACCO Modal -->
    <div id="createSaccoModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-xl max-w-md w-full p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-bold">Create New SACCO</h3>
                    <button onclick="hideCreateModal()" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <form id="createSaccoForm" onsubmit="handleCreateSacco(event)" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">SACCO Name *</label>
                        <input type="text" id="saccoName" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Region *</label>
                        <select id="saccoRegion" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
                            <option value="">Select region...</option>
                            <option value="Nairobi">Nairobi</option>
                            <option value="Central">Central</option>
                            <option value="Eastern">Eastern</option>
                            <option value="Western">Western</option>
                            <option value="Rift Valley">Rift Valley</option>
                            <option value="Coast">Coast</option>
                            <option value="Nyanza">Nyanza</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Focus Area</label>
                        <select id="saccoFocus" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
                            <option value="general">General Farming</option>
                            <option value="crops">Crop Production</option>
                            <option value="livestock">Livestock</option>
                            <option value="dairy">Dairy Farming</option>
                            <option value="horticulture">Horticulture</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Member Limit</label>
                        <input type="number" id="saccoMemberLimit" min="5" max="100" value="25" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Description</label>
                        <textarea id="saccoDescription" rows="3" placeholder="Describe your SACCO's goals..." class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"></textarea>
                    </div>
                    <div class="flex space-x-3">
                        <button type="button" onclick="hideCreateModal()" class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-700 px-4 py-2 rounded-lg">
                            Cancel
                        </button>
                        <button type="submit" class="flex-1 bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg">
                            Create SACCO
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Success/Error Messages -->
    <div id="messageContainer" class="fixed top-4 right-4 z-50"></div>

    <script>
        // Global variables
        let mySaccos = [];
        let availableSaccos = [
            {
                id: 1,
                name: 'Kiambu Farmers SACCO',
                region: 'Central',
                focus: 'crops',
                members: 45,
                memberLimit: 50,
                admin: 'John Mwangi',
                description: 'Supporting crop farmers in Kiambu with bulk purchasing and marketing'
            },
            {
                id: 2,
                name: 'Meru Coffee Growers SACCO',
                region: 'Eastern',
                focus: 'coffee',
                members: 32,
                memberLimit: 40,
                admin: 'Mary Kathure',
                description: 'Coffee farmers cooperative for better prices and quality improvement'
            },
            {
                id: 3,
                name: 'Nakuru Vegetable SACCO',
                region: 'Rift Valley',
                focus: 'horticulture',
                members: 28,
                memberLimit: 35,
                admin: 'Peter Kimani',
                description: 'Vegetable farmers working together for market access'
            },
            {
                id: 4,
                name: 'Western Dairy SACCO',
                region: 'Western',
                focus: 'dairy',
                members: 38,
                memberLimit: 45,
                admin: 'Grace Wanjiku',
                description: 'Dairy farmers cooperative for milk marketing and feed purchasing'
            }
        ];

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Page loaded, initializing...');
            loadData();
            displayData();
        });

        // Load data from localStorage
        function loadData() {
            const stored = localStorage.getItem('workingSaccos');
            if (stored) {
                mySaccos = JSON.parse(stored);
            }
            console.log('Loaded SACCOs:', mySaccos);
        }

        // Save data to localStorage
        function saveData() {
            localStorage.setItem('workingSaccos', JSON.stringify(mySaccos));
            console.log('Data saved');
        }

        // Display all data
        function displayData() {
            displayMySaccos();
            displayAvailableSaccos();
            updateStats();
        }

        // Display user's SACCOs
        function displayMySaccos() {
            const container = document.getElementById('mySaccosContainer');
            
            if (mySaccos.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <i class="fas fa-users text-4xl mb-4"></i>
                        <p>No SACCOs yet. Click "Create Test SACCO" to get started!</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = mySaccos.map(sacco => `
                <div class="border border-gray-200 rounded-lg p-4 mb-4 bg-green-50">
                    <div class="flex justify-between items-start mb-3">
                        <div>
                            <h3 class="font-bold text-gray-800">${sacco.name}</h3>
                            <p class="text-sm text-gray-600">${sacco.region} • ${sacco.focus}</p>
                        </div>
                        <span class="px-2 py-1 text-xs bg-green-100 text-green-800 rounded-full">
                            ${sacco.role || 'Admin'}
                        </span>
                    </div>
                    <p class="text-sm text-gray-600 mb-3">${sacco.description}</p>
                    <div class="flex justify-between items-center text-sm">
                        <span>Members: ${sacco.members}/${sacco.memberLimit}</span>
                        <span>Created: ${new Date(sacco.created).toLocaleDateString()}</span>
                    </div>
                    <div class="flex space-x-2 mt-3">
                        <button onclick="viewSacco(${sacco.id})" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-sm">
                            View Details
                        </button>
                        <button onclick="deleteSacco(${sacco.id})" class="bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded text-sm">
                            Delete
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // Display available SACCOs
        function displayAvailableSaccos() {
            const container = document.getElementById('availableSaccosContainer');
            
            container.innerHTML = availableSaccos.map(sacco => `
                <div class="border border-gray-200 rounded-lg p-4 mb-4">
                    <div class="flex justify-between items-start mb-3">
                        <div>
                            <h3 class="font-bold text-gray-800">${sacco.name}</h3>
                            <p class="text-sm text-gray-600">${sacco.region} • ${sacco.focus}</p>
                        </div>
                        <span class="px-2 py-1 text-xs bg-blue-100 text-blue-800 rounded-full">
                            ${sacco.members}/${sacco.memberLimit}
                        </span>
                    </div>
                    <p class="text-sm text-gray-600 mb-3">${sacco.description}</p>
                    <div class="flex justify-between items-center text-sm mb-3">
                        <span>Admin: ${sacco.admin}</span>
                        <span class="text-green-600">Available</span>
                    </div>
                    <button onclick="joinSacco(${sacco.id})" class="w-full bg-green-600 hover:bg-green-700 text-white px-3 py-2 rounded text-sm">
                        <i class="fas fa-plus mr-1"></i>Join SACCO
                    </button>
                </div>
            `).join('');
        }

        // Update statistics
        function updateStats() {
            document.getElementById('mySaccosCount').textContent = mySaccos.length;
            document.getElementById('availableSaccosCount').textContent = availableSaccos.length;
        }

        // Test create SACCO function
        function testCreateSacco() {
            console.log('Creating test SACCO...');
            
            const testSacco = {
                id: Date.now(),
                name: 'Test SACCO ' + Math.floor(Math.random() * 1000),
                region: 'Nairobi',
                focus: 'general',
                members: 1,
                memberLimit: 25,
                admin: 'Demo Farmer',
                description: 'Test SACCO created automatically',
                role: 'Admin',
                created: new Date().toISOString()
            };

            mySaccos.push(testSacco);
            saveData();
            displayData();
            
            showMessage(`✅ Test SACCO "${testSacco.name}" created successfully!`, 'success');
        }

        // Show create modal
        function showCreateModal() {
            console.log('Showing create modal...');
            document.getElementById('createSaccoModal').classList.remove('hidden');
        }

        // Hide create modal
        function hideCreateModal() {
            document.getElementById('createSaccoModal').classList.add('hidden');
            document.getElementById('createSaccoForm').reset();
        }

        // Handle create SACCO form
        function handleCreateSacco(event) {
            event.preventDefault();
            console.log('Form submitted!');

            const name = document.getElementById('saccoName').value.trim();
            const region = document.getElementById('saccoRegion').value;
            const focus = document.getElementById('saccoFocus').value;
            const memberLimit = parseInt(document.getElementById('saccoMemberLimit').value);
            const description = document.getElementById('saccoDescription').value.trim();

            if (!name || !region) {
                showMessage('❌ Please fill in all required fields', 'error');
                return;
            }

            const newSacco = {
                id: Date.now(),
                name: name,
                region: region,
                focus: focus,
                members: 1,
                memberLimit: memberLimit,
                admin: 'Demo Farmer',
                description: description || 'No description provided',
                role: 'Admin',
                created: new Date().toISOString()
            };

            mySaccos.push(newSacco);
            saveData();
            displayData();
            hideCreateModal();

            showMessage(`✅ SACCO "${name}" created successfully! You are now the admin.`, 'success');
        }

        // Join SACCO
        function joinSacco(saccoId) {
            const sacco = availableSaccos.find(s => s.id === saccoId);
            if (!sacco) return;

            if (confirm(`Join "${sacco.name}"? This will add you as a member.`)) {
                const joinedSacco = {
                    ...sacco,
                    id: Date.now(),
                    role: 'Member',
                    created: new Date().toISOString()
                };

                mySaccos.push(joinedSacco);
                saveData();
                displayData();

                showMessage(`✅ Successfully joined "${sacco.name}"!`, 'success');
            }
        }

        // View SACCO details
        function viewSacco(saccoId) {
            const sacco = mySaccos.find(s => s.id === saccoId);
            if (!sacco) return;

            alert(`SACCO Details:

Name: ${sacco.name}
Region: ${sacco.region}
Focus: ${sacco.focus}
Members: ${sacco.members}/${sacco.memberLimit}
Your Role: ${sacco.role}
Created: ${new Date(sacco.created).toLocaleDateString()}

Description: ${sacco.description}`);
        }

        // Delete SACCO
        function deleteSacco(saccoId) {
            if (confirm('Are you sure you want to delete this SACCO?')) {
                mySaccos = mySaccos.filter(s => s.id !== saccoId);
                saveData();
                displayData();
                showMessage('✅ SACCO deleted successfully', 'success');
            }
        }

        // Load sample data
        function loadSampleData() {
            const sampleSaccos = [
                {
                    id: Date.now() + 1,
                    name: 'Sample Maize Farmers SACCO',
                    region: 'Central',
                    focus: 'crops',
                    members: 15,
                    memberLimit: 30,
                    admin: 'Demo Farmer',
                    description: 'Sample SACCO for maize farmers',
                    role: 'Admin',
                    created: new Date().toISOString()
                },
                {
                    id: Date.now() + 2,
                    name: 'Sample Dairy SACCO',
                    region: 'Rift Valley',
                    focus: 'dairy',
                    members: 8,
                    memberLimit: 20,
                    admin: 'Demo Farmer',
                    description: 'Sample SACCO for dairy farmers',
                    role: 'Member',
                    created: new Date().toISOString()
                }
            ];

            mySaccos.push(...sampleSaccos);
            saveData();
            displayData();
            showMessage('✅ Sample data loaded successfully!', 'success');
        }

        // Clear all data
        function clearAllData() {
            if (confirm('Are you sure you want to clear all SACCO data?')) {
                mySaccos = [];
                saveData();
                displayData();
                showMessage('✅ All data cleared', 'success');
            }
        }

        // Show message
        function showMessage(message, type) {
            const container = document.getElementById('messageContainer');
            const messageDiv = document.createElement('div');
            
            const bgColor = type === 'success' ? 'bg-green-500' : 'bg-red-500';
            
            messageDiv.className = `${bgColor} text-white px-6 py-3 rounded-lg shadow-lg mb-2`;
            messageDiv.textContent = message;
            
            container.appendChild(messageDiv);
            
            setTimeout(() => {
                messageDiv.remove();
            }, 5000);
        }
    </script>
</body>
</html>